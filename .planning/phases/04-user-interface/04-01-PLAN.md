---
phase: 04-user-interface
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - ui/stats-tracker.lua
autonomous: true

must_haves:
  truths:
    - "Stats tracker dapat increment money collected"
    - "Stats tracker dapat increment eggs hatched"
    - "Stats tracker dapat return formatted numbers dengan thousand separator"
  artifacts:
    - path: "ui/stats-tracker.lua"
      provides: "Session stats management"
      exports: ["incrementMoney", "incrementEggs", "getFormattedMoney", "getFormattedEggs", "reset"]
  key_links:
    - from: "ui/stats-tracker.lua"
      to: "ui/main.lua"
      via: "require dan periodic update"
      pattern: "StatsTracker"
---

<objective>
Membuat stats tracker module untuk mengelola session statistics (money collected, eggs hatched).

Purpose: Module ini dibutuhkan oleh UI untuk menampilkan stats di Stats tab. Dipisah dari UI main agar dapat di-increment dari feature modules tanpa coupling ke UI.

Output: ui/stats-tracker.lua dengan increment functions dan formatted getters.
</objective>

<execution_context>
@./.opencode/get-shit-done/workflows/execute-plan.md
@./.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-user-interface/04-RESEARCH.md
@.planning/phases/04-user-interface/04-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create stats-tracker.lua module</name>
  <files>ui/stats-tracker.lua</files>
  <action>
Buat module stats tracker dengan struktur berikut:

```lua
-- ui/stats-tracker.lua
-- Session stats management untuk UI display

local StatsTracker = {
    moneyCollected = 0,
    eggsHatched = 0,
    errorsCount = 0,
    sessionStart = os.time(),
}
```

Implementasi functions:
1. `incrementMoney(amount)` - Tambah amount ke moneyCollected (default 1 jika nil)
2. `incrementEggs(count)` - Tambah count ke eggsHatched (default 1 jika nil)
3. `incrementErrors()` - Tambah 1 ke errorsCount
4. `getFormattedMoney()` - Return moneyCollected dengan thousand separator (1,250,000)
5. `getFormattedEggs()` - Return eggsHatched dengan thousand separator
6. `reset()` - Reset semua counters ke 0 dan update sessionStart

Internal helper:
- `_formatNumber(num)` - Format angka dengan thousand separator menggunakan pattern dari research:
```lua
local function formatNumber(num)
    local formatted = tostring(math.floor(num))
    local k
    while true do
        formatted, k = string.gsub(formatted, "^(-?%d+)(%d%d%d)", "%1,%2")
        if k == 0 then break end
    end
    return formatted
end
```

Export pattern mengikuti feature modules (table dengan function references).

PENTING:
- Wrap operations dalam pcall untuk safety
- Default values jika amount/count nil
- Return self untuk method chaining (opsional)
  </action>
  <verify>
File exists dan syntax valid:
```bash
cat ui/stats-tracker.lua | head -50
```
Verify exports: incrementMoney, incrementEggs, getFormattedMoney, getFormattedEggs, reset
  </verify>
  <done>
- ui/stats-tracker.lua exists
- Module exports 5+ public functions
- formatNumber menghasilkan "1,250,000" dari 1250000
  </done>
</task>

</tasks>

<verification>
- [ ] ui/stats-tracker.lua exists
- [ ] Exports incrementMoney, incrementEggs, getFormattedMoney, getFormattedEggs, reset
- [ ] formatNumber produces correct output (1250000 -> "1,250,000")
- [ ] All operations wrapped in pcall
</verification>

<success_criteria>
Stats tracker module siap untuk digunakan oleh UI main module. Dapat increment stats dan return formatted strings untuk display.
</success_criteria>

<output>
Setelah selesai, buat `.planning/phases/04-user-interface/04-01-SUMMARY.md`
</output>
