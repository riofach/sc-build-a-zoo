---
phase: 02-auto-collect-money
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - features/game-discovery.lua
autonomous: true

must_haves:
  truths:
    - "Script dapat menemukan folder player di Workspace"
    - "Script dapat iterate semua animals milik player"
    - "Script dapat mendeteksi apakah animal punya money ready"
    - "Script dapat menemukan RemoteEvent untuk collection"
  artifacts:
    - path: "features/game-discovery.lua"
      provides: "Game object discovery utilities"
      min_lines: 80
      exports: ["findPlayerFolder", "findPlayerAnimals", "isMoneyReady", "findCollectRemote"]
  key_links:
    - from: "features/game-discovery.lua"
      to: "core/services.lua"
      via: "Services.Workspace, Services.LocalPlayer"
      pattern: "Services\\.(Workspace|LocalPlayer|ReplicatedStorage)"
---

<objective>
Create game discovery utilities untuk menemukan animals milik player dan detect money-ready state.

Purpose: Foundation untuk auto-collect - tanpa discovery yang benar, collection tidak bisa berjalan
Output: `features/game-discovery.lua` dengan fungsi untuk traverse game objects
</objective>

<execution_context>
@./.opencode/get-shit-done/workflows/execute-plan.md
@./.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-auto-collect-money/02-CONTEXT.md
@.planning/phases/02-auto-collect-money/02-RESEARCH.md
@.planning/phases/01-foundation-infrastructure/01-01-SUMMARY.md
@.planning/phases/01-foundation-infrastructure/01-02-SUMMARY.md

@core/services.lua
@loader.lua
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create game-discovery.lua dengan player folder discovery</name>
  <files>features/game-discovery.lua</files>
  <action>
Create `features/game-discovery.lua` dengan fungsi discovery untuk Build A Zoo game structure.

**Requirements:**
1. Import Services dari `core/services.lua` via loadModule pattern (sesuai loader.lua)
2. Module structure dengan local table yang di-return

**Implement `findPlayerFolder()`:**
- Coba multiple common patterns:
  - `Workspace.[PlayerName]`
  - `Workspace.[UserId]`
  - `Workspace.PlayerObjects.[PlayerName]`
  - `Workspace.Zoos.[PlayerName]`
  - `Workspace.PlayerZoos.[PlayerName]`
  - `Workspace.PlayerAreas.[PlayerName]`
- Return folder instance jika ditemukan, nil jika tidak
- Log path yang ditemukan untuk debugging

**Implement `findPlayerAnimals()`:**
- Call `findPlayerFolder()` dulu
- Iterate GetDescendants() untuk cari animals
- Detection patterns (coba semua):
  - Model dengan child "Animal" atau "AnimalData"
  - Model dengan attribute "IsAnimal" = true
  - Model dengan Name yang mengandung "Animal" atau berakhir dengan jenis animal (e.g., "Lion", "Tiger")
  - Folder bernama "Animals" dan semua children-nya
- Return table of animal instances
- Gunakan pcall untuk semua game access

**Anti-patterns yang HARUS dihindari:**
- JANGAN hardcode specific paths - gunakan discovery
- JANGAN akses game objects tanpa pcall
- JANGAN return nil tanpa warning - selalu return empty table {} jika tidak ditemukan
  </action>
  <verify>
File `features/game-discovery.lua` exists dengan:
- `findPlayerFolder()` function yang return folder atau nil
- `findPlayerAnimals()` function yang return table of animals
- Semua game access wrapped dalam pcall
  </verify>
  <done>
- findPlayerFolder() mencoba 6+ folder patterns
- findPlayerAnimals() iterates descendants dan filter animals
- Semua fungsi return safe values (empty table bukan nil)
  </done>
</task>

<task type="auto">
  <name>Task 2: Add money detection dan RemoteEvent discovery</name>
  <files>features/game-discovery.lua</files>
  <action>
Tambahkan fungsi detection ke `features/game-discovery.lua`.

**Implement `isMoneyReady(animal)`:**
- Return: boolean (ready), number (amount, bisa nil)
- Detection patterns (coba semua, return true jika salah satu match):
  - NumberValue/IntValue child dengan Name "Money", "Cash", "Coins" dan Value > 0
  - Attribute "Money", "CollectableMoney", "ReadyMoney" > 0
  - BillboardGui enabled (visual indicator uang siap)
  - Part child dengan Name "MoneyDrop", "CoinDrop", "MoneyIndicator"
- Return (false, 0) jika tidak ada indicator

**Implement `findCollectRemote()`:**
- Search ReplicatedStorage:GetDescendants()
- Cari RemoteEvent atau RemoteFunction dengan Name patterns:
  - "Collect", "CollectMoney", "CollectCash", "CollectAll"
  - "Claim", "ClaimMoney", "ClaimReward"
  - "GatherMoney", "PickupMoney"
- Return first match, atau nil
- Log semua remotes yang ditemukan untuk debugging

**Implement `discoverGameStructure()`:**
- Wrapper yang call semua discovery functions
- Return discovery object:
  ```lua
  {
    playerFolder = findPlayerFolder(),
    collectRemote = findCollectRemote(),
    animalCount = #findPlayerAnimals()
  }
  ```
- Print summary untuk debugging

**Module return:**
```lua
return {
    findPlayerFolder = findPlayerFolder,
    findPlayerAnimals = findPlayerAnimals,
    isMoneyReady = isMoneyReady,
    findCollectRemote = findCollectRemote,
    discoverGameStructure = discoverGameStructure,
}
```
  </action>
  <verify>
Test manual dengan print statements:
```lua
local Discovery = require("features/game-discovery")
local result = Discovery.discoverGameStructure()
print("Player folder:", result.playerFolder)
print("Collect remote:", result.collectRemote)
print("Animal count:", result.animalCount)
```
Semua functions accessible dan return expected types.
  </verify>
  <done>
- isMoneyReady() checks 4+ patterns dan return boolean + amount
- findCollectRemote() searches ReplicatedStorage untuk 8+ name patterns
- discoverGameStructure() aggregates semua discovery results
- Module exports 5 functions
  </done>
</task>

</tasks>

<verification>
1. File `features/game-discovery.lua` exists dan syntactically valid Lua
2. Semua 5 exported functions ada: findPlayerFolder, findPlayerAnimals, isMoneyReady, findCollectRemote, discoverGameStructure
3. Tidak ada hardcoded paths - semua menggunakan discovery patterns
4. Semua game object access wrapped dalam pcall
5. Functions return safe values (empty table bukan nil untuk collections)
</verification>

<success_criteria>
- [x] features/game-discovery.lua created dengan 5 exported functions
- [x] Player folder discovery mencoba 6+ patterns
- [x] Animal detection menggunakan multiple heuristics
- [x] Money ready detection menggunakan 4+ patterns
- [x] RemoteEvent discovery searches 8+ name patterns
- [x] Semua pcall wrapped untuk safety
</success_criteria>

<output>
After completion, create `.planning/phases/02-auto-collect-money/02-01-SUMMARY.md`
</output>
